# カラーミーショップ→弥生販売 変換ツール ver 3.2 - VSCode版

**カラーミーショップの受注データと弥生販売の顧客台帳を照合して、売上伝票を自動作成するWebアプリケーション**

## 📋 概要

このツールは、カラーミーショップの受注データCSVを弥生販売の売上伝票形式に変換します。
顧客照合、新規顧客の自動採番、送料・代引き手数料の自動計算など、月末の経理作業を大幅に効率化します。

### 主な機能

- ✅ カラーミーショップCSVの自動解析
- ✅ 弥生販売 顧客台帳との自動照合（メール・電話・名前で照合）
- ✅ 新規顧客の自動採番
- ✅ セット商品の自動分解
- ✅ 送料の都道府県別自動設定
- ✅ 代引き手数料の自動計算
- ✅ クーポン割引の自動処理
- ✅ LocalStorageによるデータ保存
- ✅ 弥生販売 TXT形式（Shift-JIS, タブ区切り）で出力

## 🚀 使い方

### 1. 準備

#### 必要なファイル
1. **カラーミーショップ 受注データCSV** (`sales_all.csv`)
   - カラーミー管理画面 → 受注管理 → CSVダウンロード
   - データ種類: **受注一括データ**
   - 項目名 表示設定: **表示する**

2. **弥生販売 顧客台帳CSV**
   - 弥生販売 → ファイル → エクスポート → 得意先台帳
   - CSV形式で保存

### 2. ツールの起動

#### ローカルサーバーで起動
```bash
# Python3を使用
python3 -m http.server 8000

# または Node.jsのhttp-serverを使用
npx http-server

# ブラウザで開く
http://localhost:8000
```

#### Live Serverを使用（VSCode拡張機能）
1. VSCodeで `index.html` を開く
2. 右クリック → "Open with Live Server"

### 3. 操作手順

#### ステップ1: ファイルアップロード
1. カラーミーショップCSVをアップロード
2. 弥生販売 顧客台帳CSVをアップロード（または保存データを使用）

#### ステップ2: 顧客照合
1. 「🔍 顧客照合を開始」ボタンをクリック
2. 照合結果を確認

#### ステップ3: 新規顧客の登録（必要な場合）
1. 新規顧客リストを確認
2. 「📥 新規顧客をTXT出力」で出力
3. 弥生販売でインポート
4. インポート完了後、各顧客にチェックを入れる

#### ステップ4: 売上伝票の変換
1. 受注データリストで変換する受注を選択（デフォルトで代引きはチェック済み）
2. 伝票番号と担当者コードを確認
3. 「🚀 変換して弥生販売TXTをダウンロード」をクリック
4. ダウンロードしたTXTファイルを弥生販売でインポート

## 📁 プロジェクト構成

```
colorme-yayoi-converter/
├── index.html              # メインHTML
├── css/
│   └── styles.css         # スタイルシート
├── js/
│   ├── config.js          # 設定・定数
│   ├── storage.js         # LocalStorage操作
│   ├── parser.js          # CSV解析
│   ├── matcher.js         # 顧客照合
│   ├── converter.js       # データ変換
│   ├── ui.js              # UI操作
│   └── main.js            # メインロジック
└── README.md              # このファイル
```

## 🛠️ 技術仕様

### フロントエンド
- **HTML5** - セマンティックマークアップ
- **CSS3** - モダンレイアウト（Grid, Flexbox）
- **JavaScript (ES6 Modules)** - モジュール化された構造

### 外部ライブラリ
- **encoding.js** - Shift-JIS変換用（CDN経由）

### ブラウザ対応
- ✅ Chrome (推奨)
- ✅ Edge
- ✅ Firefox
- ✅ Safari
- ❌ Internet Explorer (非対応)

### データ仕様

#### 入力ファイル
- **カラーミーCSV**: Shift-JIS, カンマ区切り
- **弥生販売CSV**: UTF-8 BOM付き, カンマ区切り

#### 出力ファイル
- **売上伝票TXT**: Shift-JIS, タブ区切り, CRLF改行, 59項目
- **新規顧客TXT**: Shift-JIS, タブ区切り, CRLF改行, 48項目

## 🔧 カスタマイズ

### セット商品の追加

`js/config.js` の `setProducts` オブジェクトを編集：

```javascript
export const setProducts = {
    '1229': [
        { code: '1221', name: 'ビダウォーターソープ詰替用', price: 2420 },
        { code: '1224', name: '泡ポンプ400ml空容器', price: 800 }
    ],
    // 新しいセット商品を追加
    '新規コード': [
        { code: '商品1', name: '商品名1', price: 価格1 },
        { code: '商品2', name: '商品名2', price: 価格2 }
    ]
};
```

### 送料設定の変更

`js/config.js` の `shippingCodes` オブジェクトを編集：

```javascript
export const shippingCodes = {
    '北海道': '0013',
    '東京都': '0010',
    // 送料コードを変更
};
```

### 代引き手数料の変更

`js/config.js` の `calculateCODFee` 関数を編集：

```javascript
export function calculateCODFee(paymentTotal) {
    if (paymentTotal < 10000) {
        return 330;  // ← 金額を変更
    }
    // ...
}
```

## 🐛 トラブルシューティング

### CSVが読み込めない

**症状**: ファイルを選択してもエラーが出る

**解決策**:
- カラーミーショップから「受注データCSV」をダウンロード（売上詳細ではない）
- 弥生販売から最新の顧客台帳CSVをエクスポート
- ブラウザのキャッシュをクリア

### 顧客が照合されない

**症状**: すべて新規顧客になってしまう

**解決策**:
- 弥生販売の顧客台帳に顧客のメールアドレスが登録されているか確認
- 電話番号が一致しているか確認（ハイフンの有無は自動対応）
- 顧客名が完全一致しているか確認

### 文字化けする

**症状**: 出力ファイルを開くと文字化けする

**解決策**:
- 弥生販売でインポートすれば正常に表示されます
- メモ帳で開く場合は、エンコーディングを「Shift-JIS」に設定

### モジュールが読み込めない

**症状**: `Failed to load module script` エラー

**解決策**:
- ローカルサーバーを使用して起動（単にHTMLファイルを開くだけでは動作しません）
- CORS制約により、file://プロトコルではES6モジュールが読み込めません

## 📝 バージョン履歴

### ver 3.2 - VSCode版（2025年12月16日）
- ファイル分割によるモジュール化
- ES6 Modules採用
- メンテナンス性の向上
- 単一HTMLファイル版（210KB）→モジュール版

### ver 3.2 - UI改善版（2025年12月11日）
- JSONボタンの折りたたみメニュー化
- 初心者への配慮

### ver 3.1 - データ検証強化版（2025年12月11日）
- 新規顧客0件時の表示改善
- チェックボックス選択の正確性修正

### ver 2.9.4 - 実地改善版（2025年12月10日）
- 7項目の実地テスト改善
- 代引き手数料・割引の自動処理

## 📄 ライセンス

このプロジェクトは個人利用および社内利用を目的としています。

## 👤 開発者

- **Claude (Anthropic)** - AI Assistant
- **プロジェクト開始**: 2024年11月

## 🙏 謝辞

実地テストでのフィードバックをいただき、ありがとうございました。
このツールは、実際の業務での使用を通じて改善を重ねてきました。

---

**お問い合わせ・フィードバック**

不具合や改善要望がありましたら、プロジェクトのチャットでお知らせください。
